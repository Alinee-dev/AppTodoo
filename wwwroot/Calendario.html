<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Calendario</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

    <script>
        if ('serviceWorker' in navigator) {
            // ✅ Registrar Service Worker
            navigator.serviceWorker.register('/TodoApp/sw.js')
                .then(() => console.log("✅ Service Worker registrado"))
                .catch(err => console.error("❌ Error al registrar SW:", err));

            // 📢 Escuchar si el SW avisa una nueva versión
            navigator.serviceWorker.addEventListener("message", (event) => {
                if (event.data && event.data.type === "NEW_VERSION") {
                    console.log("🆕 Nueva versión disponible");

                    // Mostrar mensaje visual antes de recargar
                    const msg = document.createElement("div");
                    msg.textContent = "🔄 Actualizando Apptodo...";
                    msg.style.position = "fixed";
                    msg.style.bottom = "20px";
                    msg.style.left = "50%";
                    msg.style.transform = "translateX(-50%)";
                    msg.style.background = "#2ecc71";
                    msg.style.color = "white";
                    msg.style.padding = "12px 20px";
                    msg.style.borderRadius = "10px";
                    msg.style.fontWeight = "bold";
                    msg.style.boxShadow = "0 2px 8px rgba(0,0,0,0.3)";
                    msg.style.zIndex = "9999";
                    document.body.appendChild(msg);

                    // Espera un poco y recarga la app
                    setTimeout(() => window.location.reload(), 1500);
                }
            });
        }
    </script>


    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding-bottom: 70px; /* espacio para la barra inferior */
        }

        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 0 10px;
        }

        h1, h2 {
            margin: 0;
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #3498db;
        }

        .calendar-container {
            background-color: #fff;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            margin-bottom: 5px;
        }

            .calendar-weekdays span:nth-child(6) {
                color: #e67e22; /* Sáb */
            }


            .calendar-weekdays span:nth-child(7) {
                color: #e74c3c; /* Dom */
            }


        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            height: 60px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }

            .calendar-day.today {
                background-color: #3498db;
                color: #fff;
                font-weight: bold;
            }

        .empty-day {
            background: none;
            cursor: default;
        }


        /* ===============================
            Bottom Bar (DISEÑO MEJORADO)
        ============================== */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f5f5f5;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0;
            padding-bottom: calc(10px + env(safe-area-inset-bottom)); /* <- IMPORTANTE */
            box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
            border-top: 1px solid #ddd;
            z-index: 9999;
        }

            .bottom-bar a {
                color: #444;
                text-decoration: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                font-size: 12px;
                transition: 0.3s;
                padding: 5px 10px; /* Añadido para el borde activo */
                border-radius: 8px; /* Añadido para el borde activo */
                border: 2px solid transparent; /* BASE */
            }

                .bottom-bar a svg {
                    width: 28px;
                    height: 28px;
                    margin-bottom: 4px;
                    transition: transform 0.2s, fill 0.2s;
                    fill: #555; /* Color del SVG por defecto */
                }

                /* Resaltado para el enlace activo */
                .bottom-bar a.active {
                    border: 2px solid #3498db; /* Borde azul */
                    background-color: #ebf5fb; /* Fondo azul claro */
                    color: #3498db;
                }

                    .bottom-bar a.active svg {
                        transform: translateY(-3px) scale(1.05); /* Ligeramente más grande y levantado */
                        fill: #3498db; /* Color del SVG activo */
                    }

                /* Resaltado al pasar el ratón (Hover) */
                .bottom-bar a:hover svg {
                    transform: translateY(-2px);
                    fill: #3498db;
                }


        @media (max-width: 768px) {
            .bottom-bar {
                padding: 8px 0;
            }
        }


        /* CORRECCIÓN PARA CELULARES */
        @media (max-width: 600px) {
            .bottom-bar a {
                font-size: 10px; /* Ajuste de fuente para móviles */
                padding: 5px;
            }

            .bottom-bar svg {
                width: 28px;
                height: 28px;
            }


            /* Asegurar que la barra tenga un padding adecuado en la parte inferior */
            .bottom-bar {
                padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            }
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">



</head>
<body>

    <div class="container">
        <h1 style="text-align: center; margin-bottom: 10px;">Calendario de Organización 🗓️</h1>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button id="prev-month" class="nav-btn">&lt;</button>
            <h2 id="current-month" style="text-align: center; color: #3498db;"></h2>
            <button id="next-month" class="nav-btn">&gt;</button>
        </div>

        <div class="calendar-container">
            <div class="calendar-weekdays">
                <span>Lun</span>
                <span>Mar</span>
                <span>Mié</span>
                <span>Jue</span>
                <span>Vie</span>
                <span>Sáb</span>
                <span>Dom</span>
            </div>
            <div class="calendar" id="calendar-grid"></div>
        </div>
    </div>
    <div class="bottom-bar">
        <a href="index.html"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z" /></svg></a>
        <a href="Calendario.html" class="active"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z" /></svg></a>
        <a href="Tareas.html"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm80-80h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm200-190q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790ZM200-200v-560 560Z" /></svg></a>
        <a href="Diario.html"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M560-564v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-600q-38 0-73 9.5T560-564Zm0 220v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-380q-38 0-73 9t-67 27Zm0-110v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-490q-38 0-73 9.5T560-454ZM260-320q47 0 91.5 10.5T440-278v-394q-41-24-87-36t-93-12q-36 0-71.5 7T120-692v396q35-12 69.5-18t70.5-6Zm260 42q44-21 88.5-31.5T700-320q36 0 70.5 6t69.5 18v-396q-33-14-68.5-21t-71.5-7q-47 0-93 12t-87 36v394Zm-40 118q-48-38-104-59t-116-21q-42 0-82.5 11T100-198q-21 11-40.5-1T40-234v-482q0-11 5.5-21T62-752q46-24 96-36t102-12q58 0 113.5 15T480-740q51-30 106.5-45T700-800q52 0 102 12t96 36q11 5 16.5 15t5.5 21v482q0 23-19.5 35t-40.5 1q-37-20-77.5-31T700-240q-60 0-116 21t-104 59ZM280-494Z" /></svg></a>
        <a href="Finanzas.html"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M240-160q-66 0-113-47T80-320v-320q0-66 47-113t113-47h480q66 0 113 47t47 113v320q0 66-47 113t-113 47H240Zm0-480h480q22 0 42 5t38 16v-21q0-33-23.5-56.5T720-720H240q-33 0-56.5 23.5T160-640v21q18-11 38-16t42-5Zm-74 130 445 108q9 2 18 0t17-8l139-116q-11-15-28-24.5t-37-9.5H240q-26 0-45.5 13.5T166-510Z" /></svg></a>
        <a href="Perfil.html"><svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px"><path d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-160v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v112H160Zm80-80h480v-32q0-11-5.5-20T700-306q-54-27-109-40.5T480-360q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Zm0 400Z" /></svg></a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('calendar-grid');
            const currentMonthDisplay = document.getElementById('current-month');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');

            // El almacenamiento de eventos debe estar intacto
            const events = JSON.parse(localStorage.getItem('calendarEvents')) || {};
            let currentDate = new Date();

            function saveEvents() {
                localStorage.setItem('calendarEvents', JSON.stringify(events));
            }

            function renderCalendar() {
                grid.innerHTML = '';
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const today = new Date();
                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0).getDate();

                const monthNameOptions = { month: 'long', year: 'numeric' };
                const monthName = firstDayOfMonth.toLocaleDateString('es-ES', monthNameOptions);
                currentMonthDisplay.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

                // La lógica del calendario usa Lunes (1) como primer día y Domingo (0) como último.
                // JS getDay() retorna 0 (Dom) a 6 (Sáb).
                // startingDay = (0 (Dom) a 6 (Sáb)) => (6 (Dom) a 5 (Sáb)) [0=Lunes, 6=Domingo]
                let startingDayJS = firstDayOfMonth.getDay();
                const startingDay = (startingDayJS === 0) ? 6 : startingDayJS - 1; // 0=Lun, 6=Dom

                for (let i = 0; i < startingDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'calendar-day empty-day';
                    grid.appendChild(emptyCell);
                }

                for (let day = 1; day <= lastDayOfMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day';
                    dayCell.textContent = day;
                    const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    dayCell.dataset.date = dateKey;

                    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayCell.classList.add('today');
                    }

                    if (events[dateKey] && events[dateKey].length > 0) {
                        dayCell.dataset.events = events[dateKey].length;
                        dayCell.title = `Eventos (${events[dateKey].length}):\n- ${events[dateKey].join('\n- ')}`;

                        // Añadir un pequeño punto o indicador visual de evento (opcional, pero útil)
                        const eventDot = document.createElement('span');
                        eventDot.style.cssText = 'position: absolute; bottom: 5px; right: 5px; width: 6px; height: 6px; background-color: #e74c3c; border-radius: 50%;';
                        dayCell.appendChild(eventDot);
                    }

                    dayCell.addEventListener('click', () => handleDayClick(dayCell, dateKey));
                    grid.appendChild(dayCell);
                }
            }

            function handleDayClick(cell, dateKey) {
                const dayEvents = events[dateKey] || [];
                if (dayEvents.length > 0) {
                    showEventManagement(dateKey, dayEvents);
                } else {
                    addEventPrompt(dateKey);
                }
            }

            function showEventManagement(dateKey, dayEvents) {
                const eventList = dayEvents.map((e, i) => `${i + 1}. ${e}`).join('\n');
                let action = prompt(`Día: ${dateKey}\n\nEventos:\n${eventList}\n\nEscribe número + E (Eliminar) / M (Modificar) o 'A' para añadir:`);

                if (!action) return;

                const act = action.trim();

                if (act.toUpperCase() === 'A') {
                    addEventPrompt(dateKey);
                    return;
                }

                const match = act.match(/^(\d+)\s*([EMem])$/i);

                if (match) {
                    const index = parseInt(match[1]) - 1;
                    const op = match[2].toUpperCase();

                    if (index >= 0 && index < dayEvents.length) {
                        const eventName = dayEvents[index];

                        if (op === 'E') {
                            if (confirm(`¿Estás seguro de eliminar el evento "${eventName}"?`)) {
                                dayEvents.splice(index, 1);
                                if (dayEvents.length === 0) delete events[dateKey];
                                saveEvents(); renderCalendar();
                                alert(`Evento "${eventName}" eliminado.`);
                            }
                        } else if (op === 'M') {
                            const newName = prompt(`Modificar evento ${index + 1}: "${eventName}"`, eventName);
                            if (newName && newName.trim() !== "" && newName.trim() !== eventName) {
                                dayEvents[index] = newName.trim();
                                saveEvents(); renderCalendar();
                                alert(`Evento modificado a "${newName.trim()}"`);
                            } else if (newName && newName.trim() === "") {
                                alert("El nombre del evento no puede estar vacío.");
                            }
                        }
                    } else alert("Número de evento inválido.");
                } else alert("Formato inválido. Ej: 1E (Eliminar evento 1), 2M (Modificar evento 2), A (Añadir nuevo)");
            }

            function addEventPrompt(dateKey) {
                const eventName = prompt(`Añadir evento para ${dateKey}:`);
                if (eventName && eventName.trim() !== "") {
                    if (!events[dateKey]) events[dateKey] = [];
                    events[dateKey].push(eventName.trim());
                    saveEvents(); renderCalendar();
                    alert(`Evento "${eventName.trim()}" añadido`);
                }
            }

            prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
            nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });

            renderCalendar();
        });
    </script>

</body>
</html>